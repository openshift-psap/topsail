<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Reusable Toolbox Layer &mdash; Red Hat PSAP topsail toolbox git-main/0e164ebd documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=1bdcfe73"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Post-mortem Processing &amp; Visualization Layer" href="visualization.html" />
    <link rel="prev" title="The Test Orchestrations Layer" href="orchestration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Red Hat PSAP topsail toolbox
          </a>
              <div class="version">
                27, Feb 2026
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">TOPSAIL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Understanding The Architecture</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">The Test Orchestrations Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html#the-ci-job-launchers">The CI job launchers</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html#topsail-configuration-system">TOPSAIL Configuration System</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html#calling-the-toolbox-commands">Calling the toolbox commands</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Reusable Toolbox Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">The Post-mortem Processing &amp; Visualization Layer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending The Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extending/orchestration.html">Creating a New Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/toolbox.html">How roles are organized</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/toolbox.html#how-default-parameters-are-generated">How default parameters are generated</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/visualization.html">Creating a new visualization module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TOPSAIL's Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../toolbox.generated/index.html">Toolbox Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Red Hat PSAP topsail toolbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">The Reusable Toolbox Layer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/understanding/toolbox.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-reusable-toolbox-layer">
<h1>The Reusable Toolbox Layer<a class="headerlink" href="#the-reusable-toolbox-layer" title="Link to this heading"></a></h1>
<p>TOPSAIL’s toolbox provides an extensive set of reusable
functionalities. It is a critical part of the test orchestration, as
the toolbox commands are in charge of the majority of the operations
affecting the state of the cluster.</p>
<p>The Ansible-based design of the toolbox has proved along the last
years to be a key element in the efficiency of TOPSAIL-based
performance and scale investigations.  The Ansible roles are always
executed locally, with a custom stdout callback for easy log reading.</p>
<p>In the design of toolbox framework, post-mortem troubleshooting is one
of the key concerns. The roles are always executed with a dedicated
artifact directory (<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">artifact_extra_logs_dir</span> <span class="pre">}}</span></code>), when the tasks
are expected to store their generated source artifacts (<code class="docutils literal notranslate"><span class="pre">src</span></code>
directory), the state of the resources they have changed
(<code class="docutils literal notranslate"><span class="pre">artifacts</span></code> directory). The role should also store any other
information helpful to understand why the role execution failed, as
well as any “proof” that it executed its task correctly. These
artifacts will be reviewed after the test execution, to understand
what went wrong, if the cluster was in the right state, etc. The
artifacts can also be parsed by the post-mortem visualization engine,
to extract test results, timing information, etc:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Create</span> <span class="n">the</span> <span class="n">src</span> <span class="n">artifacts</span> <span class="n">directory</span>
  <span class="n">file</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="s2">&quot;{{ artifact_extra_logs_dir }}/src/&quot;</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">directory</span>
    <span class="n">mode</span><span class="p">:</span> <span class="s1">&#39;0755&#39;</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Create</span> <span class="n">the</span> <span class="n">nginx</span> <span class="n">HTTPS</span> <span class="n">route</span>
  <span class="n">shell</span><span class="p">:</span>
    <span class="nb">set</span> <span class="o">-</span><span class="n">o</span> <span class="n">pipefail</span><span class="p">;</span>
    <span class="n">oc</span> <span class="n">create</span> <span class="n">route</span> <span class="n">passthrough</span> <span class="n">nginx</span><span class="o">-</span><span class="n">secure</span>
       <span class="o">--</span><span class="n">service</span><span class="o">=</span><span class="n">nginx</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">https</span>
       <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;{{ cluster_deploy_nginx_server_namespace }}&quot;</span>
       <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span><span class="o">=</span><span class="n">client</span> <span class="o">-</span><span class="n">oyaml</span>
      <span class="o">|</span> <span class="n">yq</span> <span class="o">-</span><span class="n">y</span> <span class="s1">&#39;.apiVersion = &quot;route.openshift.io/v1&quot;&#39;</span>
      <span class="o">|</span> <span class="n">tee</span> <span class="s2">&quot;{{ artifact_extra_logs_dir }}/src/route_nginx-secure.yaml&quot;</span>
      <span class="o">|</span> <span class="n">oc</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span>


<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Create</span> <span class="n">the</span> <span class="n">artifacts</span> <span class="n">artifacts</span> <span class="n">directory</span>
  <span class="n">file</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="s2">&quot;{{ artifact_extra_logs_dir }}/artifacts/&quot;</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">directory</span>
    <span class="n">mode</span><span class="p">:</span> <span class="s1">&#39;0755&#39;</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">status</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Deployment</span> <span class="ow">and</span> <span class="n">Pod</span>
  <span class="n">shell</span><span class="p">:</span>
    <span class="n">oc</span> <span class="n">get</span> <span class="n">deploy</span><span class="o">/</span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span>
       <span class="o">-</span><span class="n">owide</span>
       <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;{{ cluster_deploy_nginx_server_namespace }}&quot;</span>
       <span class="o">&gt;</span> <span class="s2">&quot;{{ artifact_extra_logs_dir }}/artifacts/deployment.status&quot;</span><span class="p">;</span>

    <span class="n">oc</span> <span class="n">get</span> <span class="n">pods</span> <span class="o">-</span><span class="n">l</span> <span class="n">app</span><span class="o">=</span><span class="n">nginx</span>
       <span class="o">-</span><span class="n">owide</span>
       <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;{{ cluster_deploy_nginx_server_namespace }}&quot;</span>
       <span class="o">&gt;</span> <span class="s2">&quot;{{ artifact_extra_logs_dir }}/artifacts/pod.status&quot;</span><span class="p">;</span>

    <span class="n">oc</span> <span class="n">describe</span> <span class="n">pods</span> <span class="o">-</span><span class="n">l</span> <span class="n">app</span><span class="o">=</span><span class="n">nginx</span>
       <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;{{ cluster_deploy_nginx_server_namespace }}&quot;</span>
       <span class="o">&gt;</span> <span class="s2">&quot;{{ artifact_extra_logs_dir }}/artifacts/pod.descr&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The commands are coded with Ansible roles, with a Python API and CLI
interface on top of it.</p>
<p>So this entrypoint:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@AnsibleRole</span><span class="p">(</span><span class="s2">&quot;cluster_deploy_nginx_server&quot;</span><span class="p">)</span>
<span class="nd">@AnsibleMappedParams</span>
<span class="k">def</span> <span class="nf">deploy_nginx_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deploy an NGINX HTTP server</span>

<span class="sd">    Args:</span>
<span class="sd">        namespace: namespace where the server will be deployed. Will be create if it doesn&#39;t exist.</span>
<span class="sd">        directory: directory containing the files to serve on the HTTP server.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>will be translated into this CLI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./run_toolbox.py cluster deploy_nginx_server --help

INFO: Showing help with the command &#39;run_toolbox.py cluster deploy_nginx_server -- --help&#39;.

NAME
    run_toolbox.py cluster deploy_nginx_server - Deploy an NGINX HTTP server

SYNOPSIS
    run_toolbox.py cluster deploy_nginx_server VALUE | NAMESPACE DIRECTORY

DESCRIPTION
    Deploy an NGINX HTTP server

POSITIONAL ARGUMENTS
    NAMESPACE
        namespace where the server will be deployed. Will be create if it doesn&#39;t exist.
    DIRECTORY
        directory containing the files to serve on the HTTP server.
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="orchestration.html" class="btn btn-neutral float-left" title="The Test Orchestrations Layer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="visualization.html" class="btn btn-neutral float-right" title="The Post-mortem Processing &amp; Visualization Layer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Red Hat PSAP team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>